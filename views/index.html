<!DOCTYPE html>
<html lang="en">
<head>
    <title>TikTokWeb</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="never">
    <meta name="description" content="download douyin video images without water mask">
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="../static/stylesheets/milligram.min.css">
    <link rel="stylesheet" href="../static/stylesheets/progress.css">
    <link rel='stylesheet' href='../static/stylesheets/unicons.css'>
    <link rel='stylesheet' href='../static/stylesheets/style.css'>
    <link rel="stylesheet" href="../static/stylesheets/sweetalert2.min.css">
    <link rel="shortcut icon" href="../static/images/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="../static/images/favicon.ico">
    <script src="../static/javascripts/jquery.min.js"></script>
    <script src="../static/javascripts/jquery.cookie.min.js"></script>
    <script src="../static/javascripts/jszip.min.js"></script>
    <script src="../static/javascripts/FileSaver.min.js"></script>
</head>
<body class="bs-docs-home">
<div class="col-md-8">
    <div class="tk">
        <h1>TikTokWeb</h1>
        <blockquote>
            <p><em>å…ˆå¡«å†™ä½ çš„æŠ–éŸ³cookieï¼Œç„¶åè¾“å…¥é•¿çŸ­é“¾ç‚¹å‡»è§£æè¯•è¯•å§ğŸ‰ï¼</em></p>
        </blockquote>
        <div class="input-group input-group-lg" style="margin-bottom: 10px;">
            <input type="text" class="form-control link-input" name="è¯·è¾“å…¥é“¾æ¥" value="https://v.douyin.com/NKyY6Ch/" id="video_url">
            <div class="input-group-btn">
                <div class="btn-clear" id="btn-clear">
                    <button class="btn btn-default" type="button" value="è§£æ" id="get">è§£æ</button>
                    <button class="button button-clear" type="submit" value="è®¾ç½®Cookie" id="setcookie">è®¾ç½®Cookie</button>
                </div>
            </div>
        </div>
        <form style="display: none;" id="cookieform">
            <fieldset>
                <ul>
                    <li>
                        åªéœ€å¡«å†™cookieçš„valueï¼Œä¸éœ€è¦å¡«å†™key ğŸ˜€
                    </li>
                    <li>
                        ä¾‹å¦‚ odin_ttçš„å€¼æ˜¯718d2ae9ed49a5fd4fc1â€¦â€¦â€¦â€¦åªéœ€è¦å¡«è¿™éƒ¨åˆ†å³å¯ ğŸ¥´
                    </li>
                    <li>
                        ä½ çš„æ‰€æœ‰ä¿¡æ¯å‡å‚¨å­˜åœ¨æœ¬åœ° ğŸš¨
                    </li>
                </ul>
                <pre class="savesuccess" style="display: none;"><code>ä¿å­˜æˆåŠŸ</code></pre>
                <pre class="saveerror" style="display: none;"><code>ä¿å­˜å¤±è´¥</code></pre>
                <label for="odin_tt_Field">odin_tt</label>
                <input type="text" placeholder="odin_ttçš„å€¼" id="odin_tt_Field">
                <label for="passport_csrf_token_Field">passport_csrf_token</label>
                <input type="text" placeholder="passport_csrf_tokençš„å€¼" id="passport_csrf_token_Field">
                <label for="sessionid_ss_Field">sessionid_ss</label>
                <input type="text" placeholder="sessionid_ssçš„å€¼" id="sessionid_ss_Field">
                <label for="ttwid_Field">ttwid</label>
                <input type="text" placeholder="ttwidçš„å€¼" id="ttwid_Field">
                <label for="msToken_Field">msToken</label>
                <input type="text" placeholder="msTokençš„å€¼" id="msToken_Field">
                <button class="btn btn-default" type="button" value="ä¿å­˜" id="savecookie">ä¿å­˜</button>
                <button class="btn btn-default" type="button" value="æ¸…ç†" id="cleancookie">æ¸…ç†</button>
            </fieldset>
        </form>
        <div style="display: none;" id="video_info">
            <span>
                <div class="card">
                    <div class="card-body">
                        <div class="container">
                                <table style="overflow: auto;">
                                    <tr align="center">
                                        <td>
                                            <% if (data.type=='å›¾é›†'){%>
                                            <div class="images_play">
                                                <% for (var i = 0;i<data.images.length;i++) { %>
                                                    <img alt="<%- data.desc %>"crossorigin="anonymous" src="<%- data.images[i] %>">
                                                <%}%>
                                            </div>
                                            <%} else {%>
                                            <div class="video_play">
                                                <!--
                                                <video id="play" preload="auto" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/396624/err.mp4" autoplay muted loop></video>
                                                -->
                                                <video controls autoplay width="50%" controls="controls" id="play" preload="auto" type="video/mp4" webkit-playsinline="true" playsinline="" x5-video-player-type="h5" x5-video-player-fullscreen="portraint">
                                                    <source src="<%= data.url %>" type="video/mp4">
                                                </video>
                                            </div>
                                            <%}%>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                        <div class="row">
                                            <table align="center" style="width: 400px;">
                                                <tr align="right">
                                                    <td style="width: 160px;"><span class="column">ç±»å‹</span></td>
                                                    <td><span class="column" id="type" style="text-align: center;display: block;"><%= data.type %></span></td>
                                                </tr>
                                                <tr align="right">
                                                    <td style="width: 160px;"><span class="column">æ–‡æ¡ˆ</span></td>
                                                    <td><span class="column" id="desc" style="text-align: center;display: block;"><%= data.desc %></span></td>
                                                </tr>
                                                <tr align="right">
                                                    <td style="width: 160px;"><span class="column">æŠ–éŸ³ID</span></td>
                                                    <td><span class="column" id="unique_id" style="text-align: center;display: block;"><%= data.unique_id %></span></td>
                                                </tr>
                                                <tr align="right">
                                                    <td style="width: 160px;"><span class="column">è§†é¢‘ID</span></td>
                                                    <td><span class="column" id="video_id" style="text-align: center;display: block;"><%= data.video_id %></span></td>
                                                </tr>
                                                <tr align="right">
                                                    <td style="width: 160px;"><span class="column">ä¸»é¡µ</span></td>
                                                    <td><a class="column" id="userhome" target="_blank" href="<%= data.userhome %>" style="text-align: center;display: block;"><%= data.nickname %></a></td>
                                                </tr>
                                            </table>
                                        </div>
                                        </td>
                                    </tr>
                                    <tr align="center">
                                        <td align="center">
                                                <% if (data.type=='å›¾é›†'){%>
                                                <button type='button' id="download" style="color: white;" rel="noreferrer" onclick="downloadall();">
                                                    ä¸‹è½½æ‰€æœ‰
                                                </button>
                                                <%} else { %>
                                                <button type='button' id="download">
                                                    <a target="_blank" style="color: white;" rel="noreferrer" href="<%= data.url %>" download="<%= data.desc %>.mp4">
                                                    ä¸‹è½½è§†é¢‘
                                                    </a>
                                                </button>
                                                <% }%>
                                            </button>
                                            &nbsp;&nbsp;&nbsp;
                                            <button id="download">
                                                <a target="_blank" style="color: white;" rel="noreferrer" href="<%= data.music %>" download="<%= data.m_title %>.mp3">
                                                    <% if(data.music=='') {%>è¯¥åŸå£°ä¸å¯ç”¨<%} else {%>ä¸‹è½½åŸå£°<%} %>
                                                </a>
                                            </button>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </span>
            <footer>
                <span style="text-align: center;display: block;padding: 20px;">
                <a target="_blank" style="color: #9b4dca;" rel="noreferrer" href="https://github.com/Johnserf-Seed/TikTokWeb">
                            GitHub Â· JohnserfSeed Â· 2023
                </a>
                </span>
            </footer>
        </div>
        <!-- å›åˆ°é¡¶éƒ¨-->
        <div class="progress-wrap">
            <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
            </svg>
        </div>
    </div>
</div>
<script>
    const Toast = Swal.mixin({
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true,
        didOpen: (toast) => {
            toast.addEventListener('mouseenter', Swal.stopTimer)
            toast.addEventListener('mouseleave', Swal.resumeTimer)
        }
    });
    $(document).ready(function(){
        const COOKIE_FORM = '#cookieform';
        const VIDEO_INFO = '#video_info';
        const VIDEO_URL = "#video_url";
        const COOKIE_NAME = 'dycookie';
        const FIELDS_MAP = {
            'odin_tt': '#odin_tt_Field',
            'passport_csrf_token': '#passport_csrf_token_Field',
            'sessionid_ss': '#sessionid_ss_Field',
            'ttwid': '#ttwid_Field',
            'msToken': '#msToken_Field'
        };
        const URL_REGEXP = /((http|https):\/\/([\w\-]+\.)+[\w\-]+(\/[\w\u4e00-\u9fa5\-\.\/?\@\%\!\&=\+\~\:\#\;\,]*)?)/ig;

        function toggleForm() {
            $(COOKIE_FORM).toggle();
        }

        function populateFields(dycookie) {
            for (let key in FIELDS_MAP) {
                if (dycookie[key]) {
                    $(FIELDS_MAP[key]).val(dycookie[key]);
                }
            }
        }

        function showToast(message, icon) {
            Toast.fire(message, '', icon);
            $('#cookieform').hide();
        }

        function updateVideoLink() {
            try {
                let query = window.location.href.split("=")[1];
                query = decodeURI(query);

                if (query === 'undefined') {
                    $(VIDEO_INFO).hide();
                } else {
                    $(VIDEO_URL).val(query);
                    $(VIDEO_INFO).show();
                }
                if ('<%- videoData.work %>' === 'false') {
                    $(VIDEO_INFO).hide();
                    Swal.fire('è­¦å‘Š','æŠ–éŸ³çš„cookiæ— æ•ˆï¼Œè¯·é‡æ–°å¡«å†™','warning');
                }
            } catch (error) {
                console.error("Error:", error);
            }
        }

        $('#setcookie').click(toggleForm);
        updateVideoLink();

        $("#savecookie").click(function() {
            const dycookie = {};

            for (let key in FIELDS_MAP) {
                dycookie[key] = $(FIELDS_MAP[key]).val();
            }

            try {
                $.cookie(COOKIE_NAME, JSON.stringify(dycookie), { expires: 30 });
                showToast('ä¿å­˜æˆåŠŸ', 'success');
            } catch {
                showToast('ä¿å­˜å¤±è´¥', 'error');
            }
        });

        $("#cleancookie").click(function() {
            try {
                $.removeCookie(COOKIE_NAME, { path: '/' });
                for (let key in FIELDS_MAP) {
                    $(FIELDS_MAP[key]).val('');
                }
                showToast('æ¸…ç†æˆåŠŸ', 'success');
            } catch (error) {
                showToast('æ¸…ç†å¤±è´¥', 'error');
                console.log(error);
            }
        });

        if (!$.cookie(COOKIE_NAME)) {
            Swal.fire('æç¤º', 'å¡«å†™æŠ–éŸ³çš„cookieæ‰å¯ä»¥æ­£å¸¸è§£æ', 'warning');
        } else {
            const dycookie = JSON.parse($.cookie(COOKIE_NAME));
            populateFields(dycookie);
        }

        $("#downloadIMG").click(event => {
            event.preventDefault();
            Toast.fire('å›¾é›†æ­£åœ¨æ‰“åŒ…ä¸­ï¼Œè¯·ç¨ç­‰...','','info')
            downloadAll('<%- videoData.images %>','<%- videoData.desc %>')
        });

        $("#downloadVIDEO").click(event => {
            event.preventDefault();
            Toast.fire('è§†é¢‘æ­£åœ¨ä¸‹è½½ä¸­ï¼Œè¯·ç¨ç­‰...', '', 'info');
            downloadFile('<%- videoData.url %>', '<%= videoData.desc %>.mp4');
        });

        $("#downloadMUSIC").click(event => {
            event.preventDefault();
            Toast.fire('éŸ³ä¹æ­£åœ¨ä¸‹è½½ä¸­ï¼Œè¯·ç¨ç­‰...', '', 'info');
            downloadFile('<%= videoData.music %>', '<%= videoData.m_title %>.mp3');
        });

        $("#get").click(function() {
            if (!$.cookie('dycookie')) {
                Swal.fire('è­¦å‘Š','è¯·å…ˆå¡«å†™æŠ–éŸ³çš„cookieæ‰å¯ä»¥æ­£å¸¸è§£æä½œå“','warning');
                return;
            }

            let video_url = $('#video_url').val().trim();

            if (!video_url) {
                Swal.fire('è­¦å‘Š','è¿˜æ²¡æœ‰è¾“å…¥é“¾æ¥å“¦','warning');
                return;
            }

            if (!URL_REGEXP.test(video_url)) {
                Swal.fire('é”™è¯¯','è¯·å¡«å†™æ­£ç¡®ä½œå“é“¾æ¥','error');
                return;
            }

            window.location.href = "/api?url=" + video_url.match(URL_REGEXP)[0];
        });
    });
    </script>
    <script src="../static/javascripts/progress.js"></script>
</body>
</html>